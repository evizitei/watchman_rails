class Addresser
  class << self
    def build_full_address(addy)
      addy = apply_rewrites(addy).strip
      if is_mile_marker(addy)
        mile_marker = extract_mile_marker(addy)
        lat_long_from_mile_marker(mile_marker)
      elsif is_i70_crossover(addy)
        cross_street = extract_crossover(addy)
      else
        locality = addy.split("-").last
        city = find_city(locality)
        address = addy.gsub("-#{locality}","").gsub("/","&").gsub(/\s+/,"+")
        address.split("&").map{|item| "#{item},+#{city},+MO"}.join("&")
      end
    end
    
    def apply_rewrites(address)
      if is_missouri_highway(address)
        return address.gsub(/ROUTE\s+([A-Z]+)\s+[NSEW](|-)/,"MISSOURI \\1\\2")
      else
        address
      end
    end

    def find_city(locality)
      case locality
      when "CO"
        "Columbia"
      when "ST"
        "Sturgeon"
      when "CE"
        "Centralia"
      when "BC"
        "BOONE+COUNTY"
      when "HA"
        "HALLSVILLE"
      when "HR"
        "HARRISBURG"
      else
        "BOONE+COUNTY"
      end
    end
    
    def is_missouri_highway(address)
      clean_address = address.strip 
      clean_address =~ /^\d+\sROUTE\s+[A-Z]+\s+[NSEW](|-[A-Z]{2})$/
    end
    
    def is_mile_marker(address)
      address =~ /\d+\s+I70\s+[EW]/
    end
    
    def is_i70_crossover(address)
      addy = address.strip 
      (addy =~ /^I70 [EW]-.*\// or addy =~ /^.*\/I70 [EW]-/)
    end
    
    def extract_mile_marker(address)
      mm = address.strip.split(/\s+/).first
      if mm.size == 4
        mm = "#{mm[0,3]}.#{mm[3].chr}"
      end
      return mm
    end
    
    def extract_crossover(address)
      addy = address.strip
      (addy =~ /^I70 [EW]-.*\//)
    end
    
    # CROSSOVER_GIS_INFO_FROM_JOSH = {
    #      "ROUTE J"
    #      "ROUTE 0"
    #      "ROUTE BB"
    #      "HIGHWAY 40"
    #      "ROUTE DD"
    #      "STADIUM BLVD"
    #      "HIGHWAY 63"
    #      "ST. CHARLES RD"
    #      "ROUTE Z"
    #      "HIGHWAY 179"
    #      "HIGHWAY 40"
    #    }
    
    MM_GIS_INFO_FROM_JOSH = {
      "137"=>"38.95415604410,-92.14356698240",
      "136"=>"38.95616899990,-92.16183802610",
      "135"=>"38.95871797090,-92.18008095740",
      "134"=>"38.95889501830,-92.19866902590",
      "133"=>"38.95918203070,-92.21712304020",
      "132"=>"38.96024897310,-92.23558002120",
      "131"=>"38.96029099930,-92.25414503430",
      "130"=>"38.96109499540,-92.27262303030",
      "129"=>"38.96186600710,-92.29122003930",
      "128"=>"38.96720097370,-92.30798202980",
      "127"=>"38.96883404630,-92.32638598500",
      "126"=>"38.96906700420,-92.34505398570",
      "125"=>"38.96509997270,-92.36204699840",
      "124"=>"38.96940696440,-92.37959896760",
      "123"=>"38.97076100040,-92.39812996080",
      "122"=>"38.97143504580,-92.41668996820",
      "120"=>"38.97252497450,-92.45377903700",
      "119"=>"38.97306502290,-92.47232295430",
      "118"=>"38.97360501020,-92.49089904300",
      "117"=>"38.97413798860,-92.50944495160",
      "115"=>"38.96183604310,-92.54185202410",
      "114"=>"38.95270903800,-92.55626399810",
      "121"=>"38.97196890280,-92.43518589050",
      "116"=>"38.97084591030,-92.52744308050",
      "137.0"=>"38.95415604410,-92.14356698240",
      "136.0"=>"38.95616899990,-92.16183802610",
      "135.0"=>"38.95871797090,-92.18008095740",
      "134.0"=>"38.95889501830,-92.19866902590",
      "133.0"=>"38.95918203070,-92.21712304020",
      "132.0"=>"38.96024897310,-92.23558002120",
      "131.0"=>"38.96029099930,-92.25414503430",
      "130.0"=>"38.96109499540,-92.27262303030",
      "129.0"=>"38.96186600710,-92.29122003930",
      "128.0"=>"38.96720097370,-92.30798202980",
      "127.0"=>"38.96883404630,-92.32638598500",
      "126.0"=>"38.96906700420,-92.34505398570",
      "125.0"=>"38.96509997270,-92.36204699840",
      "124.0"=>"38.96940696440,-92.37959896760",
      "123.0"=>"38.97076100040,-92.39812996080",
      "122.0"=>"38.97143504580,-92.41668996820",
      "120.0"=>"38.97252497450,-92.45377903700",
      "119.0"=>"38.97306502290,-92.47232295430",
      "118.0"=>"38.97360501020,-92.49089904300",
      "117.0"=>"38.97413798860,-92.50944495160",
      "115.0"=>"38.96183604310,-92.54185202410",
      "114.0"=>"38.95270903800,-92.55626399810",
      "121.0"=>"38.97196890280,-92.43518589050",
      "116.0"=>"38.97084591030,-92.52744308050",
      "114.1"=>"38.95359562460,-92.55480081460",
      "114.2"=>"38.95449942140,-92.55334908900",
      "114.3"=>"38.95541029380,-92.55190471270",
      "114.4"=>"38.95632070460,-92.55046208530",
      "114.5"=>"38.95723693210,-92.54902453560",
      "114.6"=>"38.95815166240,-92.54758337620",
      "114.7"=>"38.95907851340,-92.54615192320",
      "114.8"=>"38.95998906290,-92.54471254590",
      "114.9"=>"38.96089924850,-92.54326511440",
      "115.1"=>"38.96272792880,-92.54045633290",
      "115.2"=>"38.96366728700,-92.53903738510",
      "115.3"=>"38.96458030160,-92.53759725930",
      "115.4"=>"38.96549942650,-92.53617012680",
      "115.5"=>"38.96641821790,-92.53472907190",
      "115.6"=>"38.96733305210,-92.53328824260",
      "115.7"=>"38.96825755800,-92.53185716470",
      "115.8"=>"38.96917640760,-92.53041580440",
      "115.9"=>"38.97004583850,-92.52893405350",
      "116.1"=>"38.97154031330,-92.52581811270",
      "116.2"=>"38.97218024180,-92.52411804950",
      "116.3"=>"38.97274234500,-92.52237287150",
      "116.4"=>"38.97321736970,-92.52059450700",
      "116.5"=>"38.97359391020,-92.51877559690",
      "116.6"=>"38.97387938520,-92.51693637170",
      "116.7"=>"38.97406302720,-92.51506460870",
      "116.8"=>"38.97415576320,-92.51318456330",
      "116.9"=>"38.97415930660,-92.51128950210",
      "117.1"=>"38.97404808980,-92.50759159310",
      "117.2"=>"38.97399272320,-92.50573963850",
      "117.3"=>"38.97393977460,-92.50388267060",
      "117.4"=>"38.97388369650,-92.50202837020",
      "117.5"=>"38.97382685480,-92.50017287100",
      "117.6"=>"38.97378248610,-92.49831893490",
      "117.7"=>"38.97372784820,-92.49646287350",
      "117.8"=>"38.97367295750,-92.49460853220",
      "117.9"=>"38.97362040300,-92.49275414120",
      "118.1"=>"38.97351389920,-92.48903261820",
      "118.2"=>"38.97345375090,-92.48717729630",
      "118.3"=>"38.97340132300,-92.48532296880",
      "118.4"=>"38.97336053110,-92.48346785760",
      "118.5"=>"38.97330078390,-92.48161270110",
      "118.6"=>"38.97325120440,-92.47975838090",
      "118.7"=>"38.97319588450,-92.47790119120",
      "118.8"=>"38.97314608310,-92.47604802600",
      "118.9"=>"38.97309690430,-92.47419204150",
      "119.1"=>"38.97296990410,-92.47047214980",
      "119.2"=>"38.97292357320,-92.46861544100",
      "119.3"=>"38.97287215600,-92.46676223790",
      "119.4"=>"38.97281907670,-92.46490548510",
      "119.5"=>"38.97275552720,-92.46305234600",
      "119.6"=>"38.97270695790,-92.46119763440",
      "119.7"=>"38.97264832560,-92.45934413300",
      "119.8"=>"38.97259504750,-92.45748969090",
      "119.9"=>"38.97254541010,-92.45563284570",
      "120.1"=>"38.97243380410,-92.45190480220",
      "120.2"=>"38.97237347360,-92.45004985370",
      "120.3"=>"38.97231760010,-92.44819443490",
      "120.4"=>"38.97227148680,-92.44633995210",
      "120.5"=>"38.97222314020,-92.44448275640",
      "120.6"=>"38.97216464960,-92.44262781830",
      "120.7"=>"38.97211559160,-92.44077136010",
      "120.8"=>"38.97205304400,-92.43891507280",
      "120.9"=>"38.97201673330,-92.43705615300",
      "121.1"=>"38.97192413760,-92.43337235350",
      "121.2"=>"38.97186073440,-92.43150975620",
      "121.3"=>"38.97179714150,-92.42965233520",
      "121.4"=>"38.97174820450,-92.42779756760",
      "121.5"=>"38.97168398200,-92.42594109410",
      "121.6"=>"38.97162658290,-92.42408534830",
      "121.7"=>"38.97157037870,-92.42223064910",
      "121.8"=>"38.97151218780,-92.42037689570",
      "121.9"=>"38.97146816020,-92.41852077780",
      "122.1"=>"38.97136175720,-92.41482769480",
      "122.2"=>"38.97131372720,-92.41297367920",
      "122.3"=>"38.97125587760,-92.41111842450",
      "122.4"=>"38.97118984110,-92.40926360120",
      "122.5"=>"38.97113593140,-92.40741038530",
      "122.6"=>"38.97108402990,-92.40555492290",
      "122.7"=>"38.97103568680,-92.40369768180",
      "122.8"=>"38.97096847310,-92.40184433590",
      "122.9"=>"38.97088140580,-92.39998992410",
      "123.1"=>"38.97064336720,-92.39625591830",
      "123.2"=>"38.97052603200,-92.39440647840",
      "123.3"=>"38.97041029970,-92.39255761700",
      "123.4"=>"38.97028311450,-92.39070580100",
      "123.5"=>"38.97016128770,-92.38885790190",
      "123.6"=>"38.97004432410,-92.38700770260",
      "123.7"=>"38.96992888070,-92.38515714110",
      "123.8"=>"38.96977327540,-92.38330994330",
      "123.9"=>"38.96958901340,-92.38146875780",
      "124.1"=>"38.96923333750,-92.37783028300",
      "124.2"=>"38.96902579900,-92.37596831890",
      "124.3"=>"38.96884299760,-92.37410231230",
      "124.4"=>"38.96860149540,-92.37224349950",
      "124.5"=>"38.96813226510,-92.37046872560",
      "124.6"=>"38.96751200930,-92.36876714020",
      "124.7"=>"38.96689629730,-92.36706588950",
      "124.8"=>"38.96627893810,-92.36537261300",
      "124.9"=>"38.96566221170,-92.36368343990",
      "125.1"=>"38.96470508380,-92.36031754370",
      "125.6"=>"38.96669342380,-92.35144752310",
      "125.9"=>"38.96865042530,-92.34680949310",
      "125.8"=>"38.96809582250,-92.34845857180",
      "125.7"=>"38.96747069750,-92.34985209770",
      "125.5"=>"38.96587970630,-92.35298639830",
      "125.4"=>"38.96518526230,-92.35462476990",
      "125.3"=>"38.96472311260,-92.35647360660",
      "125.2"=>"38.96456896610,-92.35839113620",
      "126.1"=>"38.96934116030,-92.34323633180",
      "126.2"=>"38.96945548430,-92.34135456050",
      "126.3"=>"38.96943412210,-92.33946462300",
      "126.4"=>"38.96935399460,-92.33758024110",
      "126.5"=>"38.96924731010,-92.33572005780",
      "126.6"=>"38.96916029870,-92.33385876610",
      "126.7"=>"38.96907561770,-92.33200649370",
      "126.8"=>"38.96898730040,-92.33013742040",
      "126.9"=>"38.96891265310,-92.32825973370",
      "127.1"=>"38.96873539030,-92.32453221410",
      "127.2"=>"38.96865142540,-92.32267940830",
      "127.3"=>"38.96855921500,-92.32082615310",
      "127.4"=>"38.96848056480,-92.31897314500",
      "127.5"=>"38.96839527680,-92.31712071210",
      "127.6"=>"38.96831736860,-92.31526636550",
      "127.7"=>"38.96819359500,-92.31340988830",
      "127.8"=>"38.96798043240,-92.31156603730",
      "127.9"=>"38.96764541680,-92.30975057250",
      "128.1"=>"38.96666489690,-92.30625975610",
      "128.2"=>"38.96608475990,-92.30455429070",
      "128.3"=>"38.96551435660,-92.30284835140",
      "128.4"=>"38.96493547650,-92.30114859500",
      "128.5"=>"38.96433270200,-92.29954295190",
      "128.6"=>"38.96370424890,-92.29799697620",
      "128.7"=>"38.96304443290,-92.29644624340",
      "128.8"=>"38.96235159400,-92.29484355670",
      "128.9"=>"38.96194289140,-92.29306280920",
      "129.1"=>"38.96175767340,-92.28936917960",
      "129.2"=>"38.96167791020,-92.28750332060",
      "129.3"=>"38.96160731620,-92.28564362960",
      "129.4"=>"38.96153353600,-92.28378250290",
      "129.5"=>"38.96145205310,-92.28192474090",
      "129.6"=>"38.96138383600,-92.28006369280",
      "129.7"=>"38.96132115940,-92.27821128140",
      "129.9"=>"38.96115062160,-92.27448088050",
      "129.8"=>"38.96123059530,-92.27634798350",
      "130.1"=>"38.96098489810,-92.27077121040",
      "130.2"=>"38.96091264460,-92.26891305000",
      "130.3"=>"38.96083021540,-92.26707758700",
      "130.4"=>"38.96077517570,-92.26523848110",
      "130.5"=>"38.96068256800,-92.26338242240",
      "130.6"=>"38.96061154690,-92.26153534140",
      "130.7"=>"38.96053885020,-92.25968787470",
      "130.8"=>"38.96040557890,-92.25783894950",
      "130.9"=>"38.96034477350,-92.25600084780",
      "131.1"=>"38.96021484210,-92.25228951180",
      "131.2"=>"38.96018483190,-92.25043269440",
      "131.3"=>"38.96020553080,-92.24857635810",
      "131.4"=>"38.96019109650,-92.24672062890",
      "131.5"=>"38.96017724680,-92.24486349320",
      "131.6"=>"38.96018071540,-92.24300691050",
      "131.7"=>"38.96021425310,-92.24114973530",
      "131.8"=>"38.96022486430,-92.23929422320",
      "131.9"=>"38.96026636000,-92.23743486420",
      "132.1"=>"38.96028558800,-92.23372573140",
      "132.2"=>"38.96031047360,-92.23186752820",
      "132.3"=>"38.96035057940,-92.23002164830",
      "132.4"=>"38.96032403970,-92.22815850130",
      "132.5"=>"38.96025448900,-92.22629899010",
      "132.6"=>"38.96013322250,-92.22444433720",
      "132.7"=>"38.95995209000,-92.22259817900",
      "132.8"=>"38.95967945010,-92.22077509040",
      "132.9"=>"38.95945208970,-92.21894656790",
      "133.1"=>"38.95893318920,-92.21529525960",
      "133.2"=>"38.95874439860,-92.21346077880",
      "133.3"=>"38.95870199150,-92.21160960010",
      "133.4"=>"38.95872772470,-92.20976508330",
      "133.5"=>"38.95875603910,-92.20792257430",
      "133.6"=>"38.95876938220,-92.20608197000",
      "133.7"=>"38.95884680970,-92.20421655390",
      "133.8"=>"38.95884576120,-92.20236573900",
      "133.9"=>"38.95884974050,-92.20052626180",
      "134.1"=>"38.95890405620,-92.19681331370",
      "134.2"=>"38.95890490640,-92.19495558920",
      "134.3"=>"38.95889440270,-92.19309365460",
      "134.4"=>"38.95888010620,-92.19123467890",
      "134.5"=>"38.95888161750,-92.18937537160",
      "134.6"=>"38.95885965530,-92.18751796760",
      "134.7"=>"38.95885370530,-92.18565970370",
      "134.8"=>"38.95879157100,-92.18380125090",
      "134.9"=>"38.95875572340,-92.18193824910",
      "135.1"=>"38.95866836300,-92.17823282730",
      "135.2"=>"38.95861710740,-92.17635927610",
      "135.3"=>"38.95846549610,-92.17450458430",
      "134.4"=>"38.95817078550,-92.17268287500",
      "134.5"=>"38.95782506030,-92.17087028630",
      "134.6"=>"38.95751070750,-92.16905699860",
      "134.7"=>"38.95717151740,-92.16724766300",
      "134.8"=>"38.95684368430,-92.16543947680",
      "134.9"=>"38.95653241850,-92.16363223890",
      "136.1"=>"38.95583784960,-92.16003123900",
      "136.2"=>"38.95549363270,-92.15822746970",
      "136.3"=>"38.95517524720,-92.15642664280",
      "136.4"=>"38.95486190640,-92.15461409670",
      "136.5"=>"38.95460936370,-92.15278177580",
      "136.6"=>"38.95443493340,-92.15094201590",
      "136.7"=>"38.95424211020,-92.14910600010",
      "136.8"=>"38.95419422110,-92.14725325030",
      "136.9"=>"38.95414197230,-92.14541953590"
    }
    def lat_long_from_mile_marker(mm)
      MM_GIS_INFO_FROM_JOSH[mm]
    end
  end
end